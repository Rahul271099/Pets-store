{% include 'base/header.html' %}
{% block content %}
    <section class="section-content padding-y bg">
        <div class="container ">
            <div class="row">
                <aside class="col-lg-8">
                    <h1>Details</h1>
                    <table class="table">
                      <thead class="h5">
                        <tr>
                          <th>Item Name:</th>
                          <th>Item Image:</th>
                          <th>Item Price:</th>
                        </tr>
                      </thead>
                      {% for items in cart_item  %}
                      <tbody>
                        <tr>
                          <td>{{ items.Pet.name }}</td>
                          <td><img src="{{ items.Pet.image.url }}" alt="" width="100px"></td>
                          <td>{{ items.Pet.price }}</td>
                        </tr>
                      </tbody>
                      {% endfor %}
                    </table>
                    <p class="text-danger h4"><span>Total Amount:</span> &#x20B9;{{ total_amount }}</p>
                </aside>
                <aside class="col-lg-4">
                    <h3>Payments</h3>
                    <div id="smart-button-container">
                        <div style="text-align: center;">
                          <div id="paypal-button-container"></div>
                        </div>
                    </div>
                    <script src="https://www.paypal.com/sdk/js?client-id=AQqXUcQUdY0kuiK0qLvPZIrFUBCCgE3-zooYTxbn7pkzKWwXIbmLLX5Xpi3P6yxzU2moR3QJGzpFPNrU&enable-funding=venmo&currency=USD" data-sdk-integration-source="button-factory"></script>
                    <script>
                      var total_amt = {{ total_amount }}
                      function initPayPalButton() {
                        paypal.Buttons({
                          style: {
                            shape: 'rect',
                            color: 'gold',
                            layout: 'vertical',
                            label: 'paypal',
                           
                          },
                  
                          createOrder: function(data, actions) {
                            return actions.order.create({
                              purchase_units: [{"amount":{"currency_code":"USD","value":total_amt}}]
                            });
                          },
                  
                          onApprove: function(data, actions) {
                            return actions.order.capture().then(function(orderData) {
                              var jsonData = JSON.stringify(orderData);
                              $.ajax({
                                url:"{% url 'order:payments' %}",
                                type:'POST',
                                data:jsonData,
                                contentType:'application/json',
                                success:function(error){
                                  //console.log(response);
                                },
                                error:function(error){
                                  console.log(error);
                                },
                              })
                             
                              // Full available details
                              console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                  
                              // Show a success message within this page, e.g.
                              const element = document.getElementById('paypal-button-container');
                              element.innerHTML = '';
                              element.innerHTML = '<h3>Thank you for your payment!</h3>';
                  
                              // Or go to another URL:  actions.redirect('thank_you.html');
                             
                            });
                          },
                  
                          onError: function(err) {
                            console.log(err);
                          } 
                        }).render('#paypal-button-container');
                      }
                      initPayPalButton();
                    </script>
                </aside>
            </div>
        </div>
    </section>
{% endblock %}
